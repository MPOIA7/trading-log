<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سجل التداول الشخصي</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <style>
        body {
            font-family: 'Tahoma', 'Arial', sans-serif;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }
        .chart-container {
            position: relative;
            height: 300px;
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid white;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-left: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Mobile improvements */
        @media (max-width: 768px) {
            .mobile-card {
                padding: 1rem;
                margin-bottom: 0.75rem;
            }
            .mobile-text {
                font-size: 0.875rem;
            }
            .mobile-button {
                padding: 0.5rem 1rem;
                font-size: 0.875rem;
            }
            .mobile-nav {
                bottom: 0;
                position: fixed;
                width: 100%;
                z-index: 40;
            }
        }
        /* Account cards */
        .account-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .account-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .account-card.active {
            border: 2px solid #3B82F6;
        }
        /* Search panel */
        .search-panel {
            transition: all 0.3s ease;
        }
        .search-panel.collapsed {
            max-height: 60px;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 min-h-screen transition-colors duration-300">
    
    <!-- Login/Register Screen -->
    <div id="authScreen" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-8 w-full max-w-md fade-in">
            <div class="text-center mb-8">
                <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mb-4">
                    <i class="fas fa-chart-line text-white text-3xl"></i>
                </div>
                <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">سجل التداول</h1>
                <p class="text-gray-600 dark:text-gray-400">تسجيل الدخول أو إنشاء حساب جديد</p>
            </div>
            
            <!-- Owner Info -->
            <div class="bg-blue-50 dark:bg-blue-900 rounded-lg p-4 mb-6 text-center">
                <p class="text-sm text-blue-800 dark:text-blue-200">
                    <i class="fas fa-user-tie ml-2"></i>
                    <strong>المطور:</strong> سليمان
                </p>
                <a href="https://t.me/MPOIA" target="_blank" class="inline-flex items-center text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 mt-2">
                    <i class="fab fa-telegram ml-2"></i>
                    تلجرام المطور
                </a>
            </div>
            
            <div id="authError" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
                <i class="fas fa-exclamation-circle ml-2"></i>
                <span id="authErrorText"></span>
            </div>
            
            <!-- Login Form -->
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">
                        <i class="fas fa-envelope ml-2"></i>البريد الإلكتروني
                    </label>
                    <input type="email" id="loginEmail" required
                        class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"
                        placeholder="أدخل بريدك الإلكتروني">
                </div>
                
                <div>
                    <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">
                        <i class="fas fa-lock ml-2"></i>كلمة المرور
                    </label>
                    <input type="password" id="loginPassword" required
                        class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"
                        placeholder="أدخل كلمة المرور">
                </div>
                
                <button type="submit" id="loginBtn"
                    class="w-full bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 transform hover:scale-105">
                    <i class="fas fa-sign-in-alt ml-2"></i>تسجيل الدخول
                </button>
            </form>
            
            <div class="mt-6 text-center">
                <button onclick="showRegisterForm()" class="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300">
                    إنشاء حساب جديد
                </button>
            </div>
            
            <!-- Register Form (Hidden by default) -->
            <form id="registerForm" class="hidden space-y-6 mt-6">
                <div>
                    <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">
                        <i class="fas fa-envelope ml-2"></i>البريد الإلكتروني
                    </label>
                    <input type="email" id="regEmail" required
                        class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"
                        placeholder="أدخل بريدك الإلكتروني">
                </div>
                
                <div>
                    <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">
                        <i class="fas fa-lock ml-2"></i>كلمة المرور
                    </label>
                    <input type="password" id="regPassword" required
                        class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"
                        placeholder="أدخل كلمة المرور (6 أحرف على الأقل)">
                </div>
                
                <div>
                    <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">
                        <i class="fas fa-lock ml-2"></i>تأكيد كلمة المرور
                    </label>
                    <input type="password" id="regPasswordConfirm" required
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"
                        placeholder="أعد إدخال كلمة المرور">
                </div>
                
                <button type="submit" id="registerBtn"
                    class="w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 transform hover:scale-105">
                    <i class="fas fa-user-plus ml-2"></i>إنشاء حساب
                </button>
                
                <div class="mt-4 text-center">
                    <button onclick="showLoginForm()" class="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300">
                        لديك حساب بالفعل؟ تسجيل الدخول
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Main App -->
    <div id="mainApp" class="hidden">
        <!-- Navigation -->
        <nav class="bg-white dark:bg-gray-800 shadow-lg sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <i class="fas fa-chart-line text-2xl text-blue-600 dark:text-blue-400"></i>
                        </div>
                        <div class="hidden md:block">
                            <div class="mr-10 flex items-baseline space-x-4 space-x-reverse">
                                <button onclick="showSection('dashboard')" class="nav-btn text-gray-900 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 px-3 py-2 rounded-md text-sm font-medium">
                                    <i class="fas fa-home ml-2"></i>الرئيسية
                                </button>
                                <button onclick="showSection('accounts')" class="nav-btn text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 px-3 py-2 rounded-md text-sm font-medium">
                                    <i class="fas fa-wallet ml-2"></i>الحسابات
                                </button>
                                <button onclick="showSection('addTrade')" class="nav-btn text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 px-3 py-2 rounded-md text-sm font-medium">
                                    <i class="fas fa-plus ml-2"></i>إضافة صفقة
                                </button>
                                <button onclick="showSection('trades')" class="nav-btn text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 px-3 py-2 rounded-md text-sm font-medium">
                                    <i class="fas fa-list ml-2"></i>سجل الصفقات
                                </button>
                                <button onclick="showSection('stats')" class="nav-btn text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 px-3 py-2 rounded-md text-sm font-medium">
                                    <i class="fas fa-chart-bar ml-2"></i>الإحصائيات
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4 space-x-reverse">
                        <div class="text-sm text-gray-600 dark:text-gray-300">
                            <i class="fas fa-user ml-2"></i>
                            <span id="currentUser">المستخدم</span>
                        </div>
                        <button id="darkModeToggle" class="text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white">
                            <i class="fas fa-moon dark:hidden"></i>
                            <i class="fas fa-sun hidden dark:inline"></i>
                        </button>
                        <button onclick="exportData()" class="text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white">
                            <i class="fas fa-download"></i>
                        </button>
                        <button onclick="logout()" class="text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
        </nav>
        
        <!-- Mobile Navigation -->
        <div class="md:hidden bg-white dark:bg-gray-800 shadow mobile-nav">
            <div class="flex justify-around py-2">
                <button onclick="showSection('dashboard')" class="nav-btn-mobile p-2 text-gray-600 dark:text-gray-300">
                    <i class="fas fa-home text-xl"></i>
                </button>
                <button onclick="showSection('accounts')" class="nav-btn-mobile p-2 text-gray-600 dark:text-gray-300">
                    <i class="fas fa-wallet text-xl"></i>
                </button>
                <button onclick="showSection('addTrade')" class="nav-btn-mobile p-2 text-gray-600 dark:text-gray-300">
                    <i class="fas fa-plus text-xl"></i>
                </button>
                <button onclick="showSection('trades')" class="nav-btn-mobile p-2 text-gray-600 dark:text-gray-300">
                    <i class="fas fa-list text-xl"></i>
                </button>
                <button onclick="showSection('stats')" class="nav-btn-mobile p-2 text-gray-600 dark:text-gray-300">
                    <i class="fas fa-chart-bar text-xl"></i>
                </button>
            </div>
        </div>
        
        <!-- Main Content -->
        <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8 mb-20 md:mb-0">
            <!-- Dashboard Section -->
            <div id="dashboardSection" class="section fade-in">
                <!-- Welcome Card -->
                <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6 mb-6 mobile-card">
                    <h1 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">
                        <i class="fas fa-home ml-2 text-blue-600 dark:text-blue-400"></i>
                        مرحباً بك في سجل التداول الخاص بك
                    </h1>
                    <p class="text-gray-600 dark:text-gray-400">تتبع صفقاتك واحصل على رؤى قيمة لأدائك</p>
                </div>
                
                <!-- Current Account Balance -->
                <div class="bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg p-6 mb-6 text-white mobile-card">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-purple-100">الحساب الحالي</p>
                            <p class="text-xl font-bold" id="currentAccountName">اختر حساب</p>
                            <p class="text-3xl font-bold mt-2" id="currentAccountBalance">$0.00</p>
                        </div>
                        <div class="text-right">
                            <span id="currentAccountType" class="px-3 py-1 bg-white bg-opacity-20 rounded-full text-sm">
                                --
                            </span>
                        </div>
                    </div>
                </div>
                
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                    <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg p-6 text-white mobile-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-blue-100 mobile-text">إجمالي الصفقات</p>
                                <p class="text-3xl font-bold" id="totalTrades">0</p>
                            </div>
                            <i class="fas fa-chart-bar text-4xl text-blue-200"></i>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-lg p-6 text-white mobile-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-green-100 mobile-text">نسبة الربح</p>
                                <p class="text-3xl font-bold" id="winRate">0%</p>
                            </div>
                            <i class="fas fa-percentage text-4xl text-green-200"></i>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg p-6 text-white mobile-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-purple-100 mobile-text">إجمالي الربح</p>
                                <p class="text-3xl font-bold" id="totalProfit">$0</p>
                            </div>
                            <i class="fas fa-trophy text-4xl text-purple-200"></i>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-red-500 to-red-600 rounded-lg p-6 text-white mobile-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-red-100 mobile-text">إجمالي الخسارة</p>
                                <p class="text-3xl font-bold" id="totalLoss">$0</p>
                            </div>
                            <i class="fas fa-times-circle text-4xl text-red-200"></i>
                        </div>
                    </div>
                </div>
                
                <!-- Performance Chart -->
                <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6 mb-6 mobile-card">
                    <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4">
                        <i class="fas fa-chart-line ml-2 text-blue-600 dark:text-blue-400"></i>
                        أداء الشهور الستة الأخيرة
                    </h2>
                    <div class="chart-container">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>
                
                <!-- Recent Trades -->
                <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6 mobile-card">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold text-gray-900 dark:text-white">
                            <i class="fas fa-history ml-2 text-blue-600 dark:text-blue-400"></i>
                            آخر الصفقات
                        </h2>
                        <button onclick="showSection('trades')" class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300">
                            عرض الكل <i class="fas fa-arrow-left mr-1"></i>
                        </button>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">التاريخ</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الزوج</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">النوع</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">النتيجة</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الربح/الخسارة</th>
                                </tr>
                            </thead>
                            <tbody id="recentTradesBody" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Accounts Section -->
            <div id="accountsSection" class="section hidden">
                <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6 mb-6 mobile-card">
                    <div class="flex justify-between items-center mb-6">
                        <h1 class="text-2xl font-bold text-gray-900 dark:text-white">
                            <i class="fas fa-wallet ml-2 text-blue-600 dark:text-blue-400"></i>
                            إدارة الحسابات
                        </h1>
                        <button onclick="showAddAccountModal()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 mobile-button">
                            <i class="fas fa-plus ml-2"></i>إضافة حساب
                        </button>
                    </div>
                    
                    <div id="accountsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Accounts will be populated by JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- Add Trade Section -->
            <div id="addTradeSection" class="section hidden">
                <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6 mobile-card">
                    <h1 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
                        <i class="fas fa-plus-circle ml-2 text-blue-600 dark:text-blue-400"></i>
                        إضافة صفقة جديدة
                    </h1>
                    
                    <!-- Account Selection -->
                    <div class="mb-6">
                        <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">
                            <i class="fas fa-wallet ml-2"></i>الحساب
                        </label>
                        <select id="tradeAccount" required
                            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                            <option value="">اختر الحساب</option>
                        </select>
                    </div>
                    
                    <form id="tradeForm" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">
                                    <i class="fas fa-coins ml-2"></i>زوج العملة / الأداة
                                </label>
                                <input type="text" id="pair" required
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"
                                    placeholder="مثال: EUR/USD">
                            </div>
                            
                            <div>
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">
                                    <i class="fas fa-exchange-alt ml-2"></i>نوع الصفقة
                                </label>
                                <select id="type" required
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                                    <option value="">اختر النوع</option>
                                    <option value="Buy">شراء (Buy)</option>
                                    <option value="Sell">بيع (Sell)</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">
                                    <i class="fas fa-tag ml-2"></i>نقطة الدخول
                                </label>
                                <input type="number" id="entryPrice" step="0.00001" required
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"
                                    placeholder="1.12345">
                            </div>
                            
                            <div>
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">
                                    <i class="fas fa-shield-alt ml-2"></i>وقف الخسارة
                                </label>
                                <input type="number" id="stopLoss" step="0.00001"
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"
                                    placeholder="1.12000">
                            </div>
                            
                            <div>
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">
                                    <i class="fas fa-trophy ml-2"></i>جني الأرباح
                                </label>
                                <input type="number" id="takeProfit" step="0.00001"
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"
                                    placeholder="1.13000">
                            </div>
                            
                            <div>
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">
                                    <i class="fas fa-weight ml-2"></i>حجم اللوت
                                </label>
                                <input type="number" id="lotSize" step="0.01" required
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"
                                    placeholder="0.10">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">
                                <i class="fas fa-lightbulb ml-2"></i>سبب الدخول
                            </label>
                            <select id="reason" required
                                class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                                <option value="">اختر السبب</option>
                                <option value="تحليل فني">تحليل فني</option>
                                <option value="تحليل أساسي">تحليل أساسي</option>
                                <option value="خبر اقتصادي">خبر اقتصادي</option>
                                <option value="استراتيجية">استراتيجية</option>
                                <option value="أخرى">أخرى</option>
                            </select>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">
                                    <i class="fas fa-flag-checkered ml-2"></i>النتيجة
                                </label>
                                <select id="result" required
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                                    <option value="">اختر النتيجة</option>
                                    <option value="profit">ربح</option>
                                    <option value="loss">خسارة</option>
                                    <option value="breakeven">تعادل</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">
                                    <i class="fas fa-dollar-sign ml-2"></i>قيمة الربح/الخسارة
                                </label>
                                <input type="number" id="profitLoss" step="0.01" required
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"
                                    placeholder="50.00">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">
                                <i class="fas fa-sticky-note ml-2"></i>ملاحظات إضافية
                            </label>
                            <textarea id="notes" rows="4"
                                class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"
                                placeholder="أي ملاحظات تود إضافتها..."></textarea>
                        </div>
                        
                        <div class="flex justify-end">
                            <button type="submit" id="saveTradeBtn"
                                class="bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 transform hover:scale-105 mobile-button">
                                <i class="fas fa-save ml-2"></i>حفظ الصفقة
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Trades Section -->
            <div id="tradesSection" class="section hidden">
                <!-- Advanced Search Panel -->
                <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6 mb-6 mobile-card search-panel" id="searchPanel">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold text-gray-900 dark:text-white">
                            <i class="fas fa-search ml-2 text-blue-600 dark:text-blue-400"></i>
                            البحث المتقدم
                        </h2>
                        <button onclick="toggleSearchPanel()" class="text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white">
                            <i class="fas fa-chevron-down" id="searchToggleIcon"></i>
                        </button>
                    </div>
                    
                    <div id="searchContent">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                            <div>
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">الحساب</label>
                                <select id="filterAccount" onchange="filterTrades()"
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                                    <option value="">الكل</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">الزوج</label>
                                <select id="filterPair" onchange="filterTrades()"
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                                    <option value="">الكل</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">النتيجة</label>
                                <select id="filterResult" onchange="filterTrades()"
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                                    <option value="">الكل</option>
                                    <option value="profit">ربح</option>
                                    <option value="loss">خسارة</option>
                                    <option value="breakeven">تعادل</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">نوع الصفقة</label>
                                <select id="filterType" onchange="filterTrades()"
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                                    <option value="">الكل</option>
                                    <option value="Buy">شراء</option>
                                    <option value="Sell">بيع</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div>
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">من التاريخ</label>
                                <input type="date" id="filterDateFrom" onchange="filterTrades()"
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                            </div>
                            
                            <div>
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">إلى التاريخ</label>
                                <input type="date" id="filterDateTo" onchange="filterTrades()"
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                            </div>
                            
                            <div>
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">الربح/الخسارة</label>
                                <select id="filterProfitRange" onchange="filterTrades()"
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                                    <option value="">الكل</option>
                                    <option value="positive">موجب فقط</option>
                                    <option value="negative">سالب فقط</option>
                                    <option value="0-50">0$ - 50$</option>
                                    <option value="50-100">50$ - 100$</option>
                                    <option value="100+">أكثر من 100$</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">حجم اللوت (من)</label>
                                <input type="number" id="filterLotSizeFrom" step="0.01" onchange="filterTrades()"
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"
                                    placeholder="0.01">
                            </div>
                            
                            <div>
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">حجم اللوت (إلى)</label>
                                <input type="number" id="filterLotSizeTo" step="0.01" onchange="filterTrades()"
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"
                                    placeholder="1.00">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">البحث</label>
                                <input type="text" id="searchInput" onkeyup="filterTrades()"
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"
                                    placeholder="ابحث في الزوج، السبب، الملاحظات...">
                            </div>
                            
                            <div class="flex items-end">
                                <button onclick="clearFilters()" 
                                    class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300 mobile-button">
                                    <i class="fas fa-times ml-2"></i>مسح الفلاتر
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Trades Table -->
                <div class="bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden mobile-card">
                    <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                        <h2 class="text-xl font-bold text-gray-900 dark:text-white">
                            <i class="fas fa-list ml-2 text-blue-600 dark:text-blue-400"></i>
                            سجل الصفقات
                            <span class="text-sm font-normal text-gray-600 dark:text-gray-400 mr-2" id="tradesCount">(0 صفقة)</span>
                        </h2>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الحساب</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">التاريخ</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الزوج</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">النوع</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الدخول</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">السبب</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">النتيجة</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الربح/الخسارة</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="tradesTableBody" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div id="noTradesMessage" class="hidden text-center py-12">
                        <i class="fas fa-inbox text-4xl text-gray-400 mb-4"></i>
                        <p class="text-gray-500 dark:text-gray-400">لا توجد صفقات مطابقة للبحث</p>
                    </div>
                </div>
            </div>
            
            <!-- Stats Section -->
            <div id="statsSection" class="section hidden">
                <!-- Stats Overview -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                    <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6 mobile-card">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-chart-bar text-blue-600 dark:text-blue-400 text-xl"></i>
                                </div>
                            </div>
                            <div class="mr-4">
                                <p class="text-sm font-medium text-gray-600 dark:text-gray-400">إجمالي الصفقات</p>
                                <p class="text-2xl font-bold text-gray-900 dark:text-white" id="statsTotalTrades">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6 mobile-card">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <div class="w-12 h-12 bg-green-100 dark:bg-green-900 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-percentage text-green-600 dark:text-green-400 text-xl"></i>
                                </div>
                            </div>
                            <div class="mr-4">
                                <p class="text-sm font-medium text-gray-600 dark:text-gray-400">نسبة الربح</p>
                                <p class="text-2xl font-bold text-gray-900 dark:text-white" id="statsWinRate">0%</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6 mobile-card">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-trophy text-purple-600 dark:text-purple-400 text-xl"></i>
                                </div>
                            </div>
                            <div class="mr-4">
                                <p class="text-sm font-medium text-gray-600 dark:text-gray-400">صفقات رابحة</p>
                                <p class="text-2xl font-bold text-gray-900 dark:text-white" id="statsWinningTrades">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6 mobile-card">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <div class="w-12 h-12 bg-red-100 dark:bg-red-900 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-times-circle text-red-600 dark:text-red-400 text-xl"></i>
                                </div>
                            </div>
                            <div class="mr-4">
                                <p class="text-sm font-medium text-gray-600 dark:text-gray-400">صفقات خاسرة</p>
                                <p class="text-2xl font-bold text-gray-900 dark:text-white" id="statsLosingTrades">0</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Detailed Stats -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6 mobile-card">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4">
                            <i class="fas fa-balance-scale ml-2 text-blue-600 dark:text-blue-400"></i>
                            متوسط الربح والخسارة
                        </h3>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600 dark:text-gray-400">متوسط الربح للصفقة الرابحة:</span>
                                <span class="text-green-600 dark:text-green-400 font-bold" id="avgWin">$0</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600 dark:text-gray-400">متوسط الخسارة للصفقة الخاسرة:</span>
                                <span class="text-red-600 dark:text-red-400 font-bold" id="avgLoss">$0</span>
                            </div>
                            <div class="flex justify-between items-center pt-3 border-t border-gray-200 dark:border-gray-700">
                                <span class="text-gray-900 dark:text-white font-semibold">نسبة المخاطرة إلى العائد:</span>
                                <span class="text-blue-600 dark:text-blue-400 font-bold" id="riskReward">N/A</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6 mobile-card">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4">
                            <i class="fas fa-chart-line ml-2 text-blue-600 dark:text-blue-400"></i>
                            أقصى القيم
                        </h3>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600 dark:text-gray-400">أكبر ربح:</span>
                                <span class="text-green-600 dark:text-green-400 font-bold" id="maxProfit">$0</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600 dark:text-gray-400">أكبر خسارة:</span>
                                <span class="text-red-600 dark:text-red-400 font-bold" id="maxLoss">$0</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Account Performance -->
                <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6 mb-6 mobile-card">
                    <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4">
                        <i class="fas fa-wallet ml-2 text-blue-600 dark:text-blue-400"></i>
                        أداء الحسابات
                    </h3>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الحساب</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">النوع</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الرصيد الحالي</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الربح/الخسارة</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">عدد الصفقات</th>
                                </tr>
                            </thead>
                            <tbody id="accountStatsBody" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Pair Performance -->
                <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6 mobile-card">
                    <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4">
                        <i class="fas fa-coins ml-2 text-blue-600 dark:text-blue-400"></i>
                        أداء الأزواج
                    </h3>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الزوج</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">عدد الصفقات</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">إجمالي الربح</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">إجمالي الخسارة</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الصافي</th>
                                </tr>
                            </thead>
                            <tbody id="pairStatsBody" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Add Account Modal -->
    <div id="addAccountModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md mx-4">
            <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4">
                <i class="fas fa-plus-circle ml-2 text-blue-600 dark:text-blue-400"></i>
                إضافة حساب جديد
            </h2>
            
            <div id="accountFormError" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
                <i class="fas fa-exclamation-circle ml-2"></i>
                <span id="accountFormErrorText"></span>
            </div>
            
            <form id="accountForm" class="space-y-4">
                <div>
                    <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">
                        <i class="fas fa-tag ml-2"></i>اسم الحساب
